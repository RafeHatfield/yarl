# Scenario: Phase 20 Corpse Lifecycle Validation
# Purpose: Regression anchor for Phase 20 corpse explosion lifecycle:
#   - FRESH corpses created on death
#   - FRESH corpses raised by Regular Necromancer
#   - Raised entities die again → SPENT corpses
#   - SPENT corpses exploded by Exploder Necromancer
#   - Explosions consume SPENT corpses → removed from map
#
# This scenario validates the full intended lifecycle and state machine integrity.

metadata:
  scenario_id: phase20_corpse_lifecycle
  family: ability_tests
  depth: 4

scenario_id: phase20_corpse_lifecycle
name: "Phase 20: Corpse Lifecycle Validation"
description: "Validate corpse lifecycle: FRESH → raise → SPENT → explode → CONSUMED"

depth: 4

defaults:
  turn_limit: 300
  player_bot: "tactical_fighter"
  allow_player_death: true
  runs: 30

expected:
  min_player_kills: 5
  min_player_deaths: 2
  max_player_deaths: 25

rooms:
  - id: "crypt"
    type: "arena"
    width: 21
    height: 15
    description: "Crypt for corpse lifecycle testing"
    walls: "enclosed"

monsters:
  # Regular Necromancer - raises FRESH corpses
  - type: "necromancer"
    count: 1
    position: [17, 7]
    facing: "west"
    state: "aware"
  
  # Exploder Necromancer - explodes SPENT corpses
  - type: "exploder_necromancer"
    count: 1
    position: [18, 9]
    facing: "west"
    state: "aware"
  
  # Skeletons - corpse sources
  - type: "skeleton"
    count: 1
    position: [13, 5]
    facing: "west"
    state: "aware"
  - type: "skeleton"
    count: 1
    position: [13, 9]
    facing: "west"
    state: "aware"
  
  # Orcs - additional corpse sources
  - type: "orc"
    count: 1
    position: [10, 6]
    facing: "west"
    state: "aware"
  - type: "orc"
    count: 1
    position: [10, 8]
    facing: "west"
    state: "aware"

items:
  # Ranged weapon
  - type: "shortbow"
    count: 1
    position: [3, 7]
  
  # Thrown weapons
  - type: "dagger"
    count: 5
    position: [3, 8]
  
  # Melee weapon
  - type: "longsword"
    count: 1
    position: [3, 5]
  
  # Healing potions (generous for extended combat)
  - type: "healing_potion"
    count: 5
    position: [2, 4]
  - type: "healing_potion"
    count: 5
    position: [2, 10]
  - type: "healing_potion"
    count: 5
    position: [3, 6]

player:
  position: [2, 7]
  facing: "east"
  inventory: []
  equipment:
    weapon: "shortsword"
    armor: "leather_armor"

# Expected lifecycle:
# 1. Player kills enemies → FRESH corpses
# 2. Necromancer raises FRESH → zombies (with lineage)
# 3. Player kills zombies → SPENT corpses (lineage tracked)
# 4. Exploder targets SPENT → explosions
# 5. Explosions consume SPENT → removed from map
#
# Metrics validation (30 runs):
# - fresh_corpses_created: >= 30 (at least 1 per run)
# - spent_corpses_created: >= 0 (observed if raises happen)
# - raises_completed: >= 0 (observed if corpses available)
# - spent_corpses_exploded: >= 0 (observed if SPENT corpses exist)

