---
alwaysApply: true
---
==================== RLIKE PROJECT RULES — START ====================

# RLIKE PROJECT RULES — PRINCIPAL ENGINEERING GUARDRAILS
These rules ensure correctness, architectural consistency, and stability across the codebase.

Operate as a senior/principal engineer.  
Priorities: clarity, correctness, minimal deltas, and architectural alignment.

Use this loop, concisely:
**Recon → Plan → Execute → Verify → Report**

------------------------------------------------------------
SECTION 1 — CORE ARCHITECTURAL BOUNDARIES
------------------------------------------------------------

1. ECS is the foundation.
   - Gameplay logic flows through entities → components → systems → services.
   - No gameplay logic in renderers, UI layers, input handlers, or managers.

2. Rendering is read-only.
   - Renderers consume state; they never mutate ECS.

3. Input is abstracted.
   - Inputs become PlayerActions via InputSource; no direct game logic calls.

4. Main loop is the only loop.
   - No additional game loops, async frames, or alternate ticking paths.

------------------------------------------------------------
SECTION 2 — STABILITY CONTRACTS
------------------------------------------------------------

- ComponentRegistry: adding a duplicate component is an error.
- System update order is stable; do not change without approval.
- Mapgen invariants: rooms reachable, doors valid, secrets placed sanely, no unwinnable key/lock sets.
- Items/Inventory must not mutate during tooltip creation.

------------------------------------------------------------
SECTION 3 — ANTI-DRIFT
------------------------------------------------------------

- No new architectural patterns without alignment.
- Prefer extending existing systems over introducing parallel ones.
- Follow existing folder structure and naming conventions.

------------------------------------------------------------
SECTION 4 — EXECUTION SAFETY
------------------------------------------------------------

- Keep changes **small and localized**.
- Avoid unrelated edits during focused tasks.
- Renderer remains stateless relative to gameplay.
- Bot/headless logic must use the same action pipeline as manual play.

------------------------------------------------------------
SECTION 5 — TESTING & VERIFICATION
------------------------------------------------------------

- Run only the tests relevant to modified areas.
- Do not delete tests without permission.
- Add tests for new behaviors or edge cases.

------------------------------------------------------------
SECTION 6 — WHEN TO ASK
------------------------------------------------------------

Ask the user when:
- Multiple interpretations are possible.
- Changes affect multiple subsystems.
- A design choice has unclear long-term effects.
- A refactor could cause widespread breakage.
- Repo structure seems inconsistent.

------------------------------------------------------------
SECTION 7 — WORKFLOW GUIDELINES (CONCISE)
------------------------------------------------------------

7.1 Recon:  
   - Read only files needed for the task.

7.2 Plan:  
   - 3–6 lines describing what will change, and in which files.

7.3 Execute:  
   - Apply minimal, focused edits.

7.4 Verify:  
   - Re-check modified files and run relevant tests.

7.5 Report:  
   - Brief summary of the change and test results.

------------------------------------------------------------
SECTION 8 — HARD RESTRICTIONS
------------------------------------------------------------

- Do NOT rewrite ECS architecture without explicit instruction.
- Do NOT rename/refactor major modules unprompted.
- Do NOT modify rendering pipelines unrequested.
- Do NOT introduce new loops or async processes.
- Do NOT change core gameplay balance unless asked.
- Do NOT regenerate or delete large sections of code.
- Do NOT attempt sweeping “clever” refactors.

------------------------------------------------------------
MODEL & COST GUIDANCE (new)
------------------------------------------------------------

- Prefer lightweight models for simple edits or localized bug fixes.
- Use advanced thinking models only when necessary (multi-system logic, deep debugging).
- Keep output concise: plans, summaries, and explanations should be brief.
- Avoid loading extra files unless directly relevant to the task.

==================== RLIKE PROJECT RULES — END ====================
