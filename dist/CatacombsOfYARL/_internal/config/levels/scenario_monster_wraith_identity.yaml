# Scenario: Wraith Identity Kit (Phase 19)
# Purpose: Regression anchor for Phase 19 wraith identity mechanics:
#   - Life Drain: Wraith heals for 50% of damage dealt (capped at missing HP)
#   - Ward Against Drain: Scroll that grants 10-turn immunity to life drain
#
# This scenario is deterministic and suitable for ongoing regression validation.

metadata:
  scenario_id: monster_wraith_identity
  family: ability_tests
  depth: 3

scenario_id: monster_wraith_identity
name: "Wraith Identity Kit (Phase 19)"
description: "Validate Phase 19 wraith life drain and ward counter mechanics."

depth: 3

defaults:
  turn_limit: 200
  player_bot: "tactical_fighter"
  allow_player_death: true
  runs: 30

expected:
  min_player_kills: 30  # 1-2 wraiths per run Ã— 30 runs
  max_player_deaths: 15  # Wraiths are dangerous with drain + speed, but ward helps

rooms:
  - id: "wraith_arena"
    type: "arena"
    width: 13
    height: 13
    description: "Arena for testing wraith life drain and ward mechanics"
    walls: "enclosed"

monsters:
  # Two wraiths to test life drain mechanics
  # Wraith stats: HP=20, speed=2.0 (bonus attack), drain=50% of damage
  - type: "wraith"
    count: 1
    position: [9, 6]
    facing: "west"
    state: "aware"
  - type: "wraith"
    count: 1
    position: [9, 7]
    facing: "west"
    state: "aware"

items:
  # Ward scrolls: primary counter to life drain
  - type: "scroll_ward_against_drain"
    count: 2
    position: [3, 5]
  
  # Healing potions: allow sustained combat
  - type: "healing_potion"
    count: 3
    position: [3, 7]
  
  # Basic weapon upgrade
  - type: "longsword"
    count: 1
    position: [3, 9]

player:
  position: [3, 6]
  facing: "east"
  inventory: []
  equipment:
    weapon: "dagger"  # Weak weapon (1d4+2 = 3-6 damage)
    armor: null  # No armor - allows wraiths to deal consistent damage for drain testing

# Scenario design notes (Phase 19 - Wraith Life Drain):
# - 2 wraiths (speed 2.0, drain 50%) in arena
# - Player starts with weak dagger to ensure wraiths survive long enough to drain
# - 2 ward scrolls available to test drain immunity mechanic
# - 3 healing potions to sustain combat and observe drain behavior
# - Expected behavior:
#   A) Without ward: Wraiths drain life and heal themselves during combat
#   B) With ward active: Wraiths hit but drain is blocked (message displayed)
# - Wraith drain amount = ceil(damage_dealt * 0.5), capped at wraith's missing HP
# - Ward duration: 10 turns (from scroll config)
# - Deterministic: No RNG in drain calculation (always applies on hit)
# - Bot should use ward scrolls when fighting wraiths (tactical behavior)
#
# Metrics validation (added to balance suite):
# - life_drain_attempts: Total wraith hits that attempted drain
# - life_drain_heal_total: Total HP healed by wraiths via drain
# - life_drain_blocked_attempts: Drain attempts blocked by ward
# - Minimum expectations (30 runs):
#   - drain_attempts >= 30 (at least 1 per run)
#   - blocked_attempts >= 5 (ward used in some runs)
#   - heal_total > 0 (drain works without ward)



