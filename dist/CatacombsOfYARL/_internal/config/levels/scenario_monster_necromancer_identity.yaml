# Scenario: Necromancer Identity Kit (Phase 19)
# Purpose: Regression anchor for Phase 19 necromancer identity mechanics:
#   - Raise Dead: Cooldown-based corpse resurrection (4-turn cooldown)
#   - Corpse Seeking: Moves toward raisable corpses when out of range
#   - Safety Constraint: Never approaches within 2 tiles of player
#   - Hang-back AI: Necromancer prefers distance 4-7 from player
#   - Corpse Persistence: Raised corpses become zombies but remain on map (consumed state)
#
# This scenario is deterministic and suitable for ongoing regression validation.

metadata:
  scenario_id: monster_necromancer_identity
  family: ability_tests
  depth: 4

scenario_id: monster_necromancer_identity
name: "Necromancer Identity Kit (Phase 19)"
description: "Validate Phase 19 necromancer mechanics: raise dead, corpse seeking, safety radius."

depth: 4

defaults:
  turn_limit: 250
  player_bot: "tactical_fighter"
  allow_player_death: true
  runs: 30

expected:
  min_player_kills: 5  # Necromancer + enemies per run Ã— 30 runs
  min_player_deaths: 5  # Should be a real threat (not a pushover)
  max_player_deaths: 20  # But not overwhelming
  # BALANCE PHILOSOPHY:
  # - 5-20 deaths validates necromancer is BOTH threatening AND beatable
  # - < 5 deaths = too easy (necromancer ineffective, needs buff)
  # - > 20 deaths = too hard (overwhelming, needs nerf)
  # - Current tuning targets ~10 deaths (33% death rate = moderate threat)

rooms:
  - id: "necromancer_crypt"
    type: "arena"
    width: 21
    height: 15
    description: "Crypt with space for corpses to spawn and necromancer to raise them"
    walls: "enclosed"

monsters:
  # Necromancer - controller who raises dead and seeks corpses
  - type: "necromancer"
    count: 1
    position: [17, 7]
    facing: "west"
    state: "aware"
  
  # Skeletons - will become corpses (with bone piles)
  # Positioned at various distances to test corpse seeking
  - type: "skeleton"
    count: 1
    position: [13, 5]
    facing: "west"
    state: "aware"
  - type: "skeleton"
    count: 1
    position: [13, 9]
    facing: "west"
    state: "aware"
  - type: "skeleton"
    count: 1
    position: [11, 7]
    facing: "west"
    state: "aware"
  
  # Orcs - additional corpse sources
  - type: "orc"
    count: 1
    position: [9, 6]
    facing: "west"
    state: "aware"
  - type: "orc"
    count: 1
    position: [9, 8]
    facing: "west"
    state: "aware"

items:
  # Ranged weapon: helps player create distant corpses
  - type: "shortbow"
    count: 1
    position: [3, 7]
  
  # Thrown weapons: alternative ranged option
  - type: "dagger"
    count: 5
    position: [3, 8]
  
  # Melee weapon: for close combat
  - type: "longsword"
    count: 1
    position: [3, 5]
  
  # Healing potions: allow extended combat to observe multiple raises
  - type: "healing_potion"
    count: 5
    position: [2, 4]
  - type: "healing_potion"
    count: 5
    position: [2, 10]
  - type: "healing_potion"
    count: 3
    position: [3, 6]

player:
  position: [2, 7]
  facing: "east"
  inventory: []
  equipment:
    weapon: "shortsword"  # Mid-tier weapon (better than dagger)
    armor: "leather_armor"  # Basic armor for survivability

# Scenario design notes (Phase 19 - Necromancer):
# - Player starts with shortsword + leather armor (moderate survivability)
# - Shortbow + arrows available on ground (ranged combat, can create distant corpses)
# - Longsword available on ground (stronger melee weapon)
# - 1 Necromancer + 3 skeletons + 2 orcs (balanced for ~5-20 deaths / 30 runs)
# - Necromancer starts at distance 17, enemies at various distances (9-13)
# - Enemy positioning creates corpses at different locations:
#   - Some corpses will be in raise range immediately
#   - Some corpses will require necromancer to seek them
# - Necromancer behavior:
#   - Raise dead on 4-turn cooldown when corpses in range (5 tiles)
#   - Seek corpses when out of range (respecting 2-tile safety radius from player)
#   - Hang back to distance 4-7 from player
#   - Never approach within 2 tiles of player (even when seeking corpses)
# - Raised zombies are friendly to necromancer (faction: cultist)
# - Corpse persistence:
#   - Corpses remain on map after being raised (transformed to zombies)
#   - CorpseComponent marked as consumed (supports future corpse explosion)
# - Arena layout: 21x15 with room for corpses to spread out
# - Healing potions: 20 total (generous supply for extended combat)
#
# Expected metrics (30 runs):
# - necro_raise_attempts: >= 20 (necromancer should attempt raises frequently)
# - necro_raise_successes: >= 20 (most raises should succeed)
# - necro_corpse_seek_moves: >= 10 (demonstrates corpse-seeking movement)
# - necro_unsafe_move_blocks: >= 0 (tracks safety constraint enforcement)
#
# Validation:
# - Necromancer raises corpses on cooldown
# - Necromancer moves toward distant corpses while respecting safety radius
# - Raised zombies are friendly to necromancer (don't attack it)
# - Corpses persist on map after being raised (marked consumed)
# - Hang-back AI keeps necromancer at safe distance
# - Cooldown prevents spam (raise_dead=4 turns)
#
# Corpse persistence invariant:
# - After successful raises, consumed corpse entities should exist on map
# - This enables future corpse explosion mechanics targeting spent corpses


